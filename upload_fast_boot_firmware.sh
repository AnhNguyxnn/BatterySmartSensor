#!/bin/bash

echo "ğŸš€ Upload Firmware vá»›i Fast Boot Path (15-20s Setup)"
echo "=================================================="

echo "ğŸ“ CÃ¡c tá»‘i Æ°u hÃ³a Ä‘Ã£ thá»±c hiá»‡n:"
echo "   âœ… Fast Boot Path - setup tá»‘i thiá»ƒu trong 3-5s"
echo "   âœ… Network task cháº¡y song song vá»›i FreeRTOS"
echo "   âœ… Web interface sáºµn sÃ ng ngay sau 5s"
echo "   âœ… Giáº£m cellular reset delay tá»« 5s xuá»‘ng 2s"
echo "   âœ… Giáº£m modem power on delay tá»« 3s xuá»‘ng 1.5s"
echo "   âœ… Giáº£m NETOPEN timeout tá»« 8s xuá»‘ng 5s"
echo "   âœ… WiFi connect vá»›i SSID cá»‘ Ä‘á»‹nh (8s timeout)"
echo "   âœ… Firmware check dá»i sau upload Ä‘áº§u tiÃªn"
echo "   âœ… NTP sync cháº¡y trong background"
echo ""

echo "ğŸ”§ Upload firmware..."
platformio run --target upload --environment esp32dev

if [ $? -eq 0 ]; then
    echo ""
    echo "âœ… Upload thÃ nh cÃ´ng!"
    echo ""
    echo "ğŸ“Š Káº¿t quáº£ mong Ä‘á»£i:"
    echo "   â€¢ Fast Boot Path: <5 giÃ¢y"
    echo "   â€¢ Web interface: 192.168.4.1 sáºµn sÃ ng ngay"
    echo "   â€¢ Network connection: 15-20 giÃ¢y (background)"
    echo "   â€¢ Tá»•ng setup time: 15-20 giÃ¢y thay vÃ¬ 40-60 giÃ¢y"
    echo ""
    echo "ğŸ” Monitor serial Ä‘á»ƒ xem káº¿t quáº£:"
    echo "   platformio device monitor -e esp32dev"
    echo ""
    echo "ğŸ“ˆ So sÃ¡nh vá»›i trÆ°á»›c:"
    echo "   â€¢ Setup time: 40-60s â†’ 15-20s (giáº£m 60-70%)"
    echo "   â€¢ Web interface: 30-40s â†’ 5s (giáº£m 85%)"
    echo "   â€¢ Network init: cháº·n â†’ background"
    echo "   â€¢ User experience: chá» lÃ¢u â†’ sáºµn sÃ ng ngay"
    echo ""
    echo "ğŸ¯ Fast Boot Path hoáº¡t Ä‘á»™ng:"
    echo "   1. ESP32 khá»Ÿi Ä‘á»™ng (<5s)"
    echo "   2. Web interface sáºµn sÃ ng ngay"
    echo "   3. Network task cháº¡y background"
    echo "   4. Khi cÃ³ máº¡ng â†’ NTP sync + upload data"
    echo ""
else
    echo ""
    echo "âŒ Upload tháº¥t báº¡i!"
    echo "Kiá»ƒm tra:"
    echo "   â€¢ ESP32 Ä‘Ã£ káº¿t ná»‘i USB"
    echo "   â€¢ Driver Ä‘Ã£ cÃ i Ä‘áº·t"
    echo "   â€¢ Port khÃ´ng bá»‹ chiáº¿m dá»¥ng"
    echo ""
fi
