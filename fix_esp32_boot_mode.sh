#!/bin/bash
# Script fix ESP32 boot mode issue

echo "ğŸ”§ Fix ESP32 Boot Mode Issue"
echo "============================"

echo "ğŸ“‹ Váº¥n Ä‘á»:"
echo "A fatal error occurred: Failed to connect to ESP32: Wrong boot mode detected (0xb)!"
echo "The chip needs to be in download mode."

echo ""
echo "âœ… Giáº£i phÃ¡p:"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 1: Manual Boot Mode Reset"
echo "======================================"
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Nháº¥n vÃ  giá»¯ nÃºt BOOT (GPIO0)"
echo "3. ğŸ”„ Nháº¥n nÃºt RESET (EN)"
echo "4. ğŸ”„ Tháº£ nÃºt RESET trÆ°á»›c"
echo "5. ğŸ”„ Tháº£ nÃºt BOOT sau"
echo "6. ğŸš€ ESP32 sáº½ vÃ o download mode"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 2: Auto Boot Mode Reset"
echo "====================================="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Nháº¥n vÃ  giá»¯ nÃºt BOOT (GPIO0)"
echo "3. ğŸ”„ Nháº¥n nÃºt RESET (EN)"
echo "4. ğŸ”„ Tháº£ nÃºt RESET trÆ°á»›c"
echo "5. ğŸ”„ Tháº£ nÃºt BOOT sau"
echo "6. ğŸš€ Cháº¡y upload command ngay láº­p tá»©c"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 3: Hardware Reset"
echo "==============================="
echo "1. ğŸ”Œ Táº¯t nguá»“n ESP32"
echo "2. ğŸ”„ Nháº¥n vÃ  giá»¯ nÃºt BOOT (GPIO0)"
echo "3. ğŸ”Œ Báº­t nguá»“n ESP32"
echo "4. ğŸ”„ Tháº£ nÃºt BOOT"
echo "5. ğŸš€ ESP32 sáº½ vÃ o download mode"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 4: Software Reset"
echo "==============================="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Nháº¥n vÃ  giá»¯ nÃºt BOOT (GPIO0)"
echo "3. ğŸ”„ Nháº¥n nÃºt RESET (EN)"
echo "4. ğŸ”„ Tháº£ nÃºt RESET trÆ°á»›c"
echo "5. ğŸ”„ Tháº£ nÃºt BOOT sau"
echo "6. ğŸš€ Cháº¡y upload command ngay láº­p tá»©c"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 5: esptool Reset"
echo "=============================="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Cháº¡y esptool reset:"
echo "   esptool.py --port /dev/ttyUSB0 run"
echo "3. ğŸš€ Cháº¡y upload command ngay láº­p tá»©c"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 6: PlatformIO Reset"
echo "================================="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Cháº¡y PlatformIO reset:"
echo "   pio run -t upload -e esp32dev --upload-port /dev/ttyUSB0"
echo "3. ğŸš€ Náº¿u fail, thá»­ láº¡i vá»›i delay"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 7: Arduino IDE Reset"
echo "=================================="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Má»Ÿ Arduino IDE"
echo "3. ğŸ”„ Chá»n Board: ESP32 Dev Module"
echo "4. ğŸ”„ Chá»n Port: /dev/ttyUSB0"
echo "5. ğŸ”„ Nháº¥n Upload"
echo "6. ğŸš€ Náº¿u fail, thá»­ láº¡i vá»›i delay"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 8: esptool Direct Upload"
echo "======================================"
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Reset ESP32 vá» download mode"
echo "3. ğŸ”„ Cháº¡y esptool direct upload:"
echo "   esptool.py --port /dev/ttyUSB0 --baud 115200 write_flash 0x10000 firmware.bin"
echo "4. ğŸš€ Náº¿u fail, thá»­ láº¡i vá»›i delay"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 9: esptool with Reset"
echo "==================================="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Cháº¡y esptool vá»›i reset:"
echo "   esptool.py --port /dev/ttyUSB0 --baud 115200 --before default_reset --after hard_reset write_flash 0x10000 firmware.bin"
echo "3. ğŸš€ Náº¿u fail, thá»­ láº¡i vá»›i delay"

echo ""
echo "ğŸ”§ PhÆ°Æ¡ng phÃ¡p 10: esptool with Chip Reset"
echo "========================================="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Cháº¡y esptool vá»›i chip reset:"
echo "   esptool.py --port /dev/ttyUSB0 --baud 115200 --before default_reset --after hard_reset --chip esp32 write_flash 0x10000 firmware.bin"
echo "3. ğŸš€ Náº¿u fail, thá»­ láº¡i vá»›i delay"

echo ""
echo "ğŸš€ CÃ¡ch sá»­ dá»¥ng:"
echo "==============="
echo "1. ğŸ”Œ Äáº£m báº£o ESP32 Ä‘Æ°á»£c cáº¯m vÃ o USB"
echo "2. ğŸ”„ Reset ESP32 vá» download mode"
echo "3. ğŸš€ Cháº¡y upload command ngay láº­p tá»©c"
echo "4. ğŸ”„ Náº¿u fail, thá»­ láº¡i vá»›i delay"

echo ""
echo "ğŸ” Troubleshooting:"
echo "=================="
echo "1. ğŸ”Œ Kiá»ƒm tra USB cable"
echo "2. ğŸ”Œ Kiá»ƒm tra USB port"
echo "3. ğŸ”Œ Kiá»ƒm tra ESP32 power"
echo "4. ğŸ”Œ Kiá»ƒm tra driver USB-Serial"
echo "5. ğŸ”Œ Kiá»ƒm tra permissions /dev/ttyUSB0"

echo ""
echo "ğŸ¯ Next Steps:"
echo "============="
echo "1. ğŸ”„ Reset ESP32 vá» download mode"
echo "2. ğŸš€ Cháº¡y upload command ngay láº­p tá»©c"
echo "3. ğŸ”„ Náº¿u fail, thá»­ láº¡i vá»›i delay"
echo "4. ğŸ” Kiá»ƒm tra hardware náº¿u váº«n fail"
